rm -rf qb3dec.wasm qb3dec.js qb3decapi.o

OPTS="-O3 -flto -msimd128"
# Standard emscripten functions
EXPORTS=_malloc,_free

# Assume libQB3.a is already built and available in the current folder
emcc $OPTS -c qb3decapi.cpp

#Build qb3dec.wasm library, with the qb3decapi exported
emcc $OPTS -o qb3dec.js qb3decapi.o libQB3.a \
    -s EXPORTED_FUNCTIONS=$EXPORTS \
    -s NO_EXIT_RUNTIME=1 \
    -s ALLOW_MEMORY_GROWTH=1 \
    --no-entry \
    -sEXPORTED_RUNTIME_METHODS=[cwrap,writeArrayToMemory,UTF8ToString]
